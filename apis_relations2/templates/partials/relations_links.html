{% load relations %}
{% load crispy_forms_tags %}

{% for rel in relation_types %}
  {% with rel|contenttypetoclass as model %}

  {% if instance %}
    {% url 'relation' rel.pk instance.pk as posturl %}
    {% url 'relationpartial' rel.pk instance.pk as hxgeturl %}
    {% if rel in relation_types_reverse %}
      {% url 'relationreversed' rel.pk instance.pk as posturl %}
      {% url 'relationpartialreversed' rel.pk instance.pk as hxgeturl %}
    {% endif %}
  {% else %}
    {% url 'relation' rel.pk as posturl %}
    {% url 'relationpartial' rel.pk as hxgeturl %}
  {% endif %}

  <a href="{{ posturl }}"

  {% if collapse %}
    data-toggle="collapse"
    data-target="#collapse-{{rel.model}}"
  {% endif %}

  {% if htmx %}
    hx-get="{{hxgeturl}}{% if next %}?next={{next}}{% endif %}"
    hx-target="#collapse-{{rel.model}}"
  {% endif %}

    ><button type="button" class="btn btn-sm">{% if rel in relation_types_reverse %}{{ model.name_reverse }}{% else %}{{ model.name }}{% endif %}</button></a>
  {% endwith %}
{% endfor %}

{% for rel in relation_types %}
<div class="collapse" id="collapse-{{ rel.model }}">
{% if not htmx %}
{% if collapse %}
  {% if instance %}
  {% relation_form rel instance as form %}
  {% else %}
  {% relation_form rel as form %}
  {% endif %}
  {% crispy form %}
{% endif %}
{% endif %}
</div>
{% endfor %}
